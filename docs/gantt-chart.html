<!-- GitHub Setup Info -->
        <div class="github-info">
            <h4>üìä Project Status Integration</h4>
            <p><strong>Repository:</strong> <span id="repo-display">Detecting...</span></p>
            <p><strong>Access:</strong> <span id="connection-status">Checking access...</span></p>
            <div id="debug-info" style="font-size: 12px; color: #6b7280; margin-top: 8px;"></div>
            <p><strong>üí° Note:</strong> <a href<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFPE Canadian Prairies Project - Interactive Gantt Chart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #059669 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #059669 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-legend {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-not-started { background: #94a3b8; }
        .status-in-progress { background: #3b82f6; }
        .status-completed { background: #10b981; }
        .status-on-hold { background: #f59e0b; }
        .status-blocked { background: #ef4444; }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        .btn {
            background: linear-gradient(135deg, #1e3a8a 0%, #059669 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(30, 58, 138, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .sync-indicator.syncing {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }

        .sync-indicator.error {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chart-container {
            padding: 30px;
            overflow-x: auto;
        }

        .activity-row {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .activity-row:hover .row-bg {
            fill: #f1f5f9;
            stroke: #3b82f6;
            stroke-width: 2;
        }

        .status-indicator {
            transition: all 0.3s ease;
        }

        .tooltip {
            position: absolute;
            background: rgba(30, 41, 59, 0.95);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .tooltip h3 {
            margin-bottom: 8px;
            color: #60a5fa;
            font-weight: 600;
        }

        .tooltip-row {
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .tooltip-label {
            font-weight: 500;
            color: #cbd5e1;
        }

        .status-dropdown {
            position: absolute;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1001;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            min-width: 180px;
        }

        .status-dropdown.show {
            opacity: 1;
            transform: translateY(0);
        }

        .status-option {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            transition: background 0.2s ease;
        }

        .status-option:hover {
            background: #f8fafc;
        }

        .status-option:first-child {
            border-radius: 6px 6px 0 0;
        }

        .status-option:last-child {
            border-radius: 0 0 6px 6px;
        }

        .progress-summary {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .progress-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .progress-item h4 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .progress-item p {
            color: #64748b;
            font-weight: 500;
        }

        .auth-section {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .auth-section.show {
            display: block;
        }

        .auth-form {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .auth-input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            min-width: 200px;
        }

        .github-info {
            background: #e0f2fe;
            border: 1px solid #0284c7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .github-info h4 {
            margin-bottom: 8px;
            color: #0c4a6e;
        }

        .github-info a {
            color: #0284c7;
            text-decoration: none;
        }

        .github-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .chart-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OFPE Canadian Prairies Project Timeline</h1>
            <p>Interactive Gantt Chart ‚Ä¢ January 2026 - March 2028</p>
        </div>

        <!-- GitHub Setup Info -->
        <div class="github-info">
            <h4>üìä Project Status Integration</h4>
            <p><strong>Repository:</strong> <span id="repo-display">Detecting...</span></p>
            <p><strong>Access:</strong> <span id="connection-status">Checking access...</span></p>
            <div id="debug-info" style="font-size: 12px; color: #6b7280; margin-top: 8px; padding: 8px; background: #f9fafb; border-radius: 4px;"></div>
            <div id="external-viewer-help" style="display: none; margin-top: 10px; padding: 10px; background: #fffbeb; border: 1px solid #fbbf24; border-radius: 6px; font-size: 13px;">
                <p><strong>üëã External Viewer?</strong> If you're viewing this project as a stakeholder or partner:</p>
                <p>‚Ä¢ Ask the project team for the correct repository link</p>
                <p>‚Ä¢ Or ask them to share the project status dashboard link</p>
                <p>‚Ä¢ Current display shows default values until connected to live data</p>
            </div>
            <p><strong>üí° Note:</strong> 
                Status loads automatically from GitHub. 
                <a href="#" onclick="toggleAuthSection()">Configure connection</a> to update status or specify a different repository.
            </p>
        </div>

        <!-- Authentication Section -->
        <div class="auth-section" id="auth-section">
            <h4>üîë GitHub Repository Configuration</h4>
            <p><strong>Configure repository to view current status or enable status updates.</strong></p>
            <div class="auth-form">
                <input type="text" class="auth-input" id="github-owner" placeholder="GitHub Username/Organization (e.g., yourname)">
                <input type="text" class="auth-input" id="github-repo" placeholder="Repository Name (e.g., ofpe-project)">
                <input type="password" class="auth-input" id="github-token" placeholder="Personal Access Token (optional for viewing)">
                <button class="btn" onclick="configureGitHub()">Connect Repository</button>
                <button class="btn btn-secondary" onclick="toggleAuthSection()">Cancel</button>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 6px; font-size: 13px;">
                <p><strong>üîç For viewing status:</strong> Just enter username and repository name</p>
                <p><strong>‚úèÔ∏è For updating status:</strong> Also add your Personal Access Token 
                   <a href="https://github.com/settings/tokens" target="_blank">‚Üí Create token</a></p>
                <p><strong>üìã Example:</strong> Username: <code>john-doe</code>, Repository: <code>ofpe-canadian-prairies</code></p>
            </div>
        </div>
        
        <div class="controls">
            <div class="status-legend">
                <strong>Status Legend:</strong>
                <div class="status-item">
                    <div class="status-dot status-not-started"></div>
                    <span>Not Started</span>
                </div>
                <div class="status-item">
                    <div class="status-dot status-in-progress"></div>
                    <span>In Progress</span>
                </div>
                <div class="status-item">
                    <div class="status-dot status-completed"></div>
                    <span>Completed</span>
                </div>
                <div class="status-item">
                    <div class="status-dot status-on-hold"></div>
                    <span>On Hold</span>
                </div>
                <div class="status-item">
                    <div class="status-dot status-blocked"></div>
                    <span>Blocked</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <div class="sync-status">
                    <div class="sync-indicator" id="sync-indicator"></div>
                    <span id="sync-text">Ready</span>
                </div>
                <button class="btn" onclick="syncWithGitHub()" id="sync-btn">üîÑ Sync Data</button>
                <button class="btn" onclick="exportProgress()">üìä Export Progress</button>
            </div>
        </div>

        <div class="chart-container">
            <svg width="1300" height="850" xmlns="http://www.w3.org/2000/svg" id="gantt-chart">
                <!-- SVG content same as before -->
                <defs>
                    <linearGradient id="ofpe" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#60a5fa"/>
                        <stop offset="100%" style="stop-color:#3b82f6"/>
                    </linearGradient>
                    <linearGradient id="data" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#f87171"/>
                        <stop offset="100%" style="stop-color:#ef4444"/>
                    </linearGradient>
                    <linearGradient id="ktt" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#34d399"/>
                        <stop offset="100%" style="stop-color:#10b981"/>
                    </linearGradient>
                    <linearGradient id="infrastructure" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#a78bfa"/>
                        <stop offset="100%" style="stop-color:#8b5cf6"/>
                    </linearGradient>
                    <linearGradient id="reporting" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#fb923c"/>
                        <stop offset="100%" style="stop-color:#f97316"/>
                    </linearGradient>
                </defs>
                
                <!-- Background -->
                <rect width="1300" height="850" fill="#fdfdfd" stroke="#e2e8f0" stroke-width="1"/>
                
                <!-- Header Area -->
                <rect x="0" y="25" width="1300" height="90" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
                
                <!-- Task Column Header -->
                <rect x="0" y="25" width="350" height="90" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2"/>
                <text x="175" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e293b">Activity</text>
                
                <!-- Year Headers -->
                <rect x="350" y="25" width="422" height="30" fill="#cbd5e1" stroke="#94a3b8" stroke-width="1"/>
                <text x="561" y="44" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e293b">2026</text>
                
                <rect x="772" y="25" width="422" height="30" fill="#cbd5e1" stroke="#94a3b8" stroke-width="1"/>
                <text x="983" y="44" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e293b">2027</text>
                
                <rect x="1194" y="25" width="106" height="30" fill="#cbd5e1" stroke="#94a3b8" stroke-width="1"/>
                <text x="1247" y="44" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e293b">2028</text>
                
                <!-- Quarter Headers -->
                <g font-family="Arial, sans-serif" font-size="14" fill="#475569" text-anchor="middle">
                    <rect x="350" y="55" width="105" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="402" y="74">Q1</text>
                    <rect x="455" y="55" width="106" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="508" y="74">Q2</text>
                    <rect x="561" y="55" width="105" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="614" y="74">Q3</text>
                    <rect x="666" y="55" width="106" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="719" y="74">Q4</text>
                    
                    <rect x="772" y="55" width="105" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="825" y="74">Q1</text>
                    <rect x="877" y="55" width="106" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="930" y="74">Q2</text>
                    <rect x="983" y="55" width="105" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="1036" y="74">Q3</text>
                    <rect x="1088" y="55" width="106" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="1141" y="74">Q4</text>
                    
                    <rect x="1194" y="55" width="106" height="30" fill="#f1f5f9" stroke="#e2e8f0" stroke-width="1"/>
                    <text x="1247" y="74">Q1</text>
                </g>
                
                <!-- Month Headers -->
                <g font-family="Arial, sans-serif" font-size="12" fill="#64748b" text-anchor="middle">
                    <text x="367" y="102">Jan</text>
                    <text x="402" y="102">Feb</text>
                    <text x="437" y="102">Mar</text>
                    <text x="472" y="102">Apr</text>
                    <text x="507" y="102">May</text>
                    <text x="542" y="102">Jun</text>
                    <text x="577" y="102">Jul</text>
                    <text x="612" y="102">Aug</text>
                    <text x="647" y="102">Sep</text>
                    <text x="682" y="102">Oct</text>
                    <text x="717" y="102">Nov</text>
                    <text x="752" y="102">Dec</text>
                    
                    <text x="789" y="102">Jan</text>
                    <text x="824" y="102">Feb</text>
                    <text x="859" y="102">Mar</text>
                    <text x="894" y="102">Apr</text>
                    <text x="929" y="102">May</text>
                    <text x="964" y="102">Jun</text>
                    <text x="999" y="102">Jul</text>
                    <text x="1034" y="102">Aug</text>
                    <text x="1069" y="102">Sep</text>
                    <text x="1104" y="102">Oct</text>
                    <text x="1139" y="102">Nov</text>
                    <text x="1174" y="102">Dec</text>
                    
                    <text x="1211" y="102">Jan</text>
                    <text x="1246" y="102">Feb</text>
                    <text x="1281" y="102">Mar</text>
                </g>
                
                <!-- Grid Lines -->
                <line x1="772" y1="25" x2="772" y2="750" stroke="#94a3b8" stroke-width="3"/>
                <line x1="1194" y1="25" x2="1194" y2="750" stroke="#94a3b8" stroke-width="3"/>
                <line x1="455" y1="55" x2="455" y2="750" stroke="#cbd5e1" stroke-width="1"/>
                <line x1="561" y1="55" x2="561" y2="750" stroke="#cbd5e1" stroke-width="1"/>
                <line x1="666" y1="55" x2="666" y2="750" stroke="#cbd5e1" stroke-width="1"/>
                <line x1="877" y1="55" x2="877" y2="750" stroke="#cbd5e1" stroke-width="1"/>
                <line x1="983" y1="55" x2="983" y2="750" stroke="#cbd5e1" stroke-width="1"/>
                <line x1="1088" y1="55" x2="1088" y2="750" stroke="#cbd5e1" stroke-width="1"/>
                <line x1="0" y1="115" x2="1300" y2="115" stroke="#e2e8f0" stroke-width="2"/>
                
                <!-- Activity Rows -->
                <g id="activity-rows"></g>
                
                <!-- Legend -->
                <rect x="0" y="750" width="1300" height="80" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
                <text x="650" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e293b">Category Legend</text>
                
                <circle cx="120" cy="800" r="10" fill="url(#ofpe)"/>
                <text x="140" y="805" font-family="Arial, sans-serif" font-size="13" fill="#475569">OFPE Implementation</text>
                
                <circle cx="320" cy="800" r="10" fill="url(#data)"/>
                <text x="340" y="805" font-family="Arial, sans-serif" font-size="13" fill="#475569">Data Analysis &amp; Insights</text>
                
                <circle cx="550" cy="800" r="10" fill="url(#ktt)"/>
                <text x="570" y="805" font-family="Arial, sans-serif" font-size="13" fill="#475569">Knowledge Transfer &amp; Capacity Building</text>
                
                <circle cx="850" cy="800" r="10" fill="url(#infrastructure)"/>
                <text x="870" y="805" font-family="Arial, sans-serif" font-size="13" fill="#475569">Data Infrastructure</text>
                
                <circle cx="1080" cy="800" r="10" fill="url(#reporting)"/>
                <text x="1100" y="805" font-family="Arial, sans-serif" font-size="13" fill="#475569">Project Management/Reporting</text>
            </svg>
        </div>

        <div class="progress-summary" id="progress-summary">
            <!-- Progress summary will be populated by JavaScript -->
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Status Dropdown -->
    <div class="status-dropdown" id="status-dropdown">
        <div class="status-option" data-status="not-started">
            <div class="status-dot status-not-started"></div>
            <span>Not Started</span>
        </div>
        <div class="status-option" data-status="in-progress">
            <div class="status-dot status-in-progress"></div>
            <span>In Progress</span>
        </div>
        <div class="status-option" data-status="completed">
            <div class="status-dot status-completed"></div>
            <span>Completed</span>
        </div>
        <div class="status-option" data-status="on-hold">
            <div class="status-dot status-on-hold"></div>
            <span>On Hold</span>
        </div>
        <div class="status-option" data-status="blocked">
            <div class="status-dot status-blocked"></div>
            <span>Blocked</span>
        </div>
    </div>

    <script>
        // Activity data
        const activities = [
            {
                id: 1,
                title: "Develop & Disseminate Extension Materials",
                description: "Ongoing creation and distribution of targeted extension content",
                category: "Knowledge Transfer & Capacity Building",
                startDate: "Jan 2026",
                endDate: "Mar 2028",
                duration: "27 months",
                bars: [{x: 350, width: 950, fill: "url(#ktt)"}]
            },
            {
                id: 2,
                title: "Conduct Training for Partners",
                description: "Training sessions for commodity board staff and collaborators",
                category: "Knowledge Transfer & Capacity Building",
                startDate: "Jan-Mar 2026 & Jan-Mar 2027",
                endDate: "",
                duration: "6 months total",
                bars: [
                    {x: 350, width: 105, fill: "url(#ktt)"},
                    {x: 772, width: 105, fill: "url(#ktt)"}
                ]
            },
            {
                id: 3,
                title: "Establish Foundational Field Data Repository",
                description: "Setup infrastructure & protocols for Western Canadian Field Data Repository",
                category: "Data Infrastructure",
                startDate: "Jan 2026",
                endDate: "Jul 2027",
                duration: "19 months",
                bars: [{x: 350, width: 649, fill: "url(#infrastructure)"}]
            },
            {
                id: 4,
                title: "Conduct Field Trials",
                description: "Establish and manage OFPE trials. Includes data collection.",
                category: "OFPE Implementation",
                startDate: "Apr-Sep 2026 & Apr-Sep 2027",
                endDate: "",
                duration: "12 months total",
                bars: [
                    {x: 455, width: 211, fill: "url(#ofpe)"},
                    {x: 877, width: 211, fill: "url(#ofpe)"}
                ]
            },
            {
                id: 5,
                title: "Present in Scientific and Industry Conferences",
                description: "Presentation at scientific and industry-related conferences",
                category: "Knowledge Transfer & Capacity Building",
                startDate: "Q3 2026, Jan 2027, Q3 2027, Jan 2028",
                endDate: "",
                duration: "Multiple events",
                bars: [
                    {x: 561, width: 105, fill: "url(#ktt)"},
                    {x: 772, width: 35, fill: "url(#ktt)"},
                    {x: 983, width: 105, fill: "url(#ktt)"},
                    {x: 1194, width: 35, fill: "url(#ktt)"}
                ]
            },
            {
                id: 6,
                title: "Generate Individualized Trial Reports",
                description: "Analyze field data and generate individual trial reports",
                category: "Data Analysis & Insights",
                startDate: "Oct-Dec 2026 & Oct-Dec 2027",
                endDate: "",
                duration: "6 months total",
                bars: [
                    {x: 666, width: 106, fill: "url(#data)"},
                    {x: 1088, width: 106, fill: "url(#data)"}
                ]
            },
            {
                id: 7,
                title: "Present at Canadian Commodity Board Meetings",
                description: "Project progress and observations at annual general meetings",
                category: "Knowledge Transfer & Capacity Building",
                startDate: "Jan-Feb 2027 & Jan-Feb 2028",
                endDate: "",
                duration: "4 months total",
                bars: [
                    {x: 772, width: 70, fill: "url(#ktt)"},
                    {x: 1194, width: 70, fill: "url(#ktt)"}
                ]
            },
            {
                id: 8,
                title: "Mid-Term Project Report Submission",
                description: "Compilation and submission of the mid-term project report",
                category: "Project Management/Reporting",
                startDate: "Feb-Mar 2027",
                endDate: "",
                duration: "2 months",
                bars: [{x: 807, width: 70, fill: "url(#reporting)"}]
            },
            {
                id: 9,
                title: "Develop Comprehensive DIFM Evaluation Reports",
                description: "Reports on DIFM capabilities and analytical performance",
                category: "Data Analysis & Insights",
                startDate: "Oct-Dec 2027",
                endDate: "",
                duration: "3 months",
                bars: [{x: 1088, width: 106, fill: "url(#data)"}]
            },
            {
                id: 10,
                title: "Develop Preliminary Regional Recommendations",
                description: "Data analysis for regional fertilizer and seed rate recommendations",
                category: "Data Analysis & Insights",
                startDate: "Oct-Dec 2027",
                endDate: "",
                duration: "3 months",
                bars: [{x: 1088, width: 106, fill: "url(#data)"}]
            },
            {
                id: 11,
                title: "Assess Observed Impacts of OFPE on Farm Practices",
                description: "Evaluation of OFPE influence on farm management practices",
                category: "Data Analysis & Insights",
                startDate: "Oct-Dec 2027",
                endDate: "",
                duration: "3 months",
                bars: [{x: 1088, width: 106, fill: "url(#data)"}]
            },
            {
                id: 12,
                title: "Finalize All Insights & Recommendations",
                description: "Comprehensive finalization of all economic analyses",
                category: "Data Analysis & Insights",
                startDate: "Jan-Mar 2028",
                endDate: "",
                duration: "3 months",
                bars: [{x: 1194, width: 106, fill: "url(#data)"}]
            },
            {
                id: 13,
                title: "Final Project Report Submission",
                description: "Compilation and submission of the comprehensive final report",
                category: "Project Management/Reporting",
                startDate: "Feb-Mar 2028",
                endDate: "",
                duration: "2 months",
                bars: [{x: 1229, width: 71, fill: "url(#reporting)"}]
            }
        ];

        // GitHub configuration
        let githubConfig = {
            owner: '',
            repo: '',
            token: '',
            branch: 'main',
            dataPath: 'data/project-status.json'
        };

        // Fallback repository info for public viewing
        // This should be set to your actual repository information
        const DEFAULT_REPO = {
            owner: '',  // Will be auto-detected from URL or set manually
            repo: ''    // Will be auto-detected from URL or set manually
        };

        // Activity statuses
        let activityStatuses = {};

        // Initialize all activities with default status
        activities.forEach(activity => {
            if (!(activity.id in activityStatuses)) {
                activityStatuses[activity.id] = 'not-started';
            }
        });

        // Status colors
        const statusColors = {
            'not-started': '#94a3b8',
            'in-progress': '#3b82f6',
            'completed': '#10b981',
            'on-hold': '#f59e0b',
            'blocked': '#ef4444'
        };

        // DOM elements
        const tooltip = document.getElementById('tooltip');
        const statusDropdown = document.getElementById('status-dropdown');
        const activityRowsGroup = document.getElementById('activity-rows');

        let currentActivityId = null;

        // Load configuration from localStorage
        function loadConfiguration() {
            try {
                const saved = localStorage.getItem('ofpe-github-config');
                if (saved) {
                    const config = JSON.parse(saved);
                    githubConfig = { ...githubConfig, ...config };
                    updateConnectionStatus();
                }
            } catch (e) {
                console.log('Could not load configuration');
            }
        }

        // Save configuration to localStorage
        function saveConfiguration() {
            try {
                localStorage.setItem('ofpe-github-config', JSON.stringify(githubConfig));
            } catch (e) {
                console.log('Could not save configuration');
            }
        }

        // Update connection status display
        function updateConnectionStatus() {
            const repoDisplay = document.getElementById('repo-display');
            const connectionStatus = document.getElementById('connection-status');
            
            const detectedOwner = getOwnerFromUrl();
            const detectedRepo = getRepoFromUrl();
            
            if (githubConfig.owner && githubConfig.repo) {
                repoDisplay.textContent = `${githubConfig.owner}/${githubConfig.repo}`;
                if (githubConfig.token) {
                    connectionStatus.innerHTML = '‚úÖ Connected - Can read and update status';
                } else {
                    connectionStatus.innerHTML = 'üëÄ Read-only access - Configure token to update status';
                }
            } else if (detectedOwner && detectedRepo) {
                repoDisplay.textContent = `${detectedOwner}/${detectedRepo} (auto-detected)`;
                connectionStatus.innerHTML = 'üëÄ Read-only access - Configure for status updates';
            } else {
                repoDisplay.textContent = 'Not detected - configure manually';
                connectionStatus.innerHTML = '‚ö†Ô∏è Configure GitHub connection for status access';
            }
        }

        // Toggle auth section
        function toggleAuthSection() {
            const authSection = document.getElementById('auth-section');
            authSection.classList.toggle('show');
            
            if (authSection.classList.contains('show')) {
                // Pre-fill with existing values
                document.getElementById('github-owner').value = githubConfig.owner || '';
                document.getElementById('github-repo').value = githubConfig.repo || '';
                document.getElementById('github-token').value = githubConfig.token || '';
            }
        }

        // Configure GitHub connection
        function configureGitHub() {
            const owner = document.getElementById('github-owner').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            const token = document.getElementById('github-token').value.trim();

            if (!owner || !repo) {
                alert('Please provide both GitHub username/organization and repository name.');
                return;
            }

            githubConfig.owner = owner;
            githubConfig.repo = repo;
            githubConfig.token = token;

            saveConfiguration();
            updateConnectionStatus();
            toggleAuthSection();

            // Try to load status immediately with new configuration
            syncWithGitHub();
        }

        // Update sync status
        function updateSyncStatus(status, message) {
            const indicator = document.getElementById('sync-indicator');
            const text = document.getElementById('sync-text');
            const btn = document.getElementById('sync-btn');

            indicator.className = 'sync-indicator';
            btn.disabled = false;

            switch (status) {
                case 'syncing':
                    indicator.classList.add('syncing');
                    text.textContent = message || 'Syncing...';
                    btn.disabled = true;
                    break;
                case 'success':
                    text.textContent = message || 'Synced';
                    break;
                case 'error':
                    indicator.classList.add('error');
                    text.textContent = message || 'Error';
                    break;
                default:
                    text.textContent = message || 'Ready';
            }
        }

        // GitHub API functions
        async function fetchFromGitHub() {
            if (!githubConfig.owner || !githubConfig.repo) {
                throw new Error('GitHub repository not configured');
            }

            const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.dataPath}`;
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'User-Agent': 'OFPE-Project-Tracker'
            };

            if (githubConfig.token) {
                headers['Authorization'] = `token ${githubConfig.token}`;
            }

            const response = await fetch(url, { headers });
            
            if (response.status === 404) {
                // File doesn't exist yet, return default data
                return null;
            }

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            const content = atob(data.content);
            return JSON.parse(content);
        }

        async function saveToGitHub() {
            if (!githubConfig.owner || !githubConfig.repo) {
                throw new Error('Repository information not configured');
            }

            if (!githubConfig.token) {
                throw new Error('Personal Access Token required for updates');
            }

            const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.dataPath}`;
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json',
                'User-Agent': 'OFPE-Project-Tracker',
                'Authorization': `token ${githubConfig.token}`
            };

            // First, try to get the current file to get its SHA
            let sha = null;
            try {
                const response = await fetch(url, { headers });
                if (response.ok) {
                    const data = await response.json();
                    sha = data.sha;
                }
            } catch (e) {
                // File might not exist, which is fine
            }

            // Prepare the data
            const statusData = {
                lastUpdated: new Date().toISOString(),
                project: "OFPE Canadian Prairies Project",
                activities: activities.map(activity => ({
                    id: activity.id,
                    title: activity.title,
                    status: activityStatuses[activity.id] || 'not-started'
                }))
            };

            const content = btoa(JSON.stringify(statusData, null, 2));

            const body = {
                message: `Update project status - ${new Date().toLocaleString()}`,
                content: content,
                branch: githubConfig.branch
            };

            if (sha) {
                body.sha = sha;
            }

            const response = await fetch(url, {
                method: 'PUT',
                headers: headers,
                body: JSON.stringify(body)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`GitHub API error: ${response.status} - ${errorData.message || response.statusText}`);
            }

            return await response.json();
        }

        // Sync with GitHub
        async function syncWithGitHub() {
            updateSyncStatus('syncing', 'Loading status...');

            try {
                // Always try to fetch latest data (public read access)
                const githubData = await fetchFromGitHub();
                
                if (githubData && githubData.activities) {
                    // Update local status with GitHub data
                    githubData.activities.forEach(activity => {
                        activityStatuses[activity.id] = activity.status;
                    });
                    
                    // Update visual indicators
                    updateAllStatusIndicators();
                    updateProgressSummary();
                    
                    updateSyncStatus('success', 'Status loaded from GitHub');
                } else {
                    updateSyncStatus('success', 'Using default status');
                }
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('error', 'Could not load from GitHub');
                
                // Don't show alert for read errors, just use defaults
                console.log('Using default status values');
            }
        }

        // Create activity rows
        function createActivityRows() {
            let yPosition = 115;
            
            activities.forEach((activity, index) => {
                const rowGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                rowGroup.classList.add('activity-row');
                rowGroup.setAttribute('data-activity-id', activity.id);
                
                // Row background
                const rowBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rowBg.classList.add('row-bg');
                rowBg.setAttribute('x', '0');
                rowBg.setAttribute('y', yPosition.toString());
                rowBg.setAttribute('width', '350');
                rowBg.setAttribute('height', '45');
                rowBg.setAttribute('fill', index % 2 === 0 ? '#ffffff' : '#fafafa');
                rowBg.setAttribute('stroke', '#f1f5f9');
                rowBg.setAttribute('stroke-width', '1');
                
                // Status indicator
                const statusIndicator = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                statusIndicator.classList.add('status-indicator');
                statusIndicator.setAttribute('cx', '25');
                statusIndicator.setAttribute('cy', (yPosition + 22).toString());
                statusIndicator.setAttribute('r', '6');
                statusIndicator.setAttribute('fill', statusColors[activityStatuses[activity.id]]);
                
                // Activity title
                const title = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                title.setAttribute('x', '40');
                title.setAttribute('y', (yPosition + 17).toString());
                title.setAttribute('font-family', 'Arial, sans-serif');
                title.setAttribute('font-size', '12');
                title.setAttribute('font-weight', 'bold');
                title.setAttribute('fill', '#1e293b');
                title.textContent = activity.title;
                
                // Activity description
                const description = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                description.setAttribute('x', '40');
                description.setAttribute('y', (yPosition + 33).toString());
                description.setAttribute('font-family', 'Arial, sans-serif');
                description.setAttribute('font-size', '10');
                description.setAttribute('fill', '#64748b');
                description.textContent = activity.description;
                
                // Timeline bars
                activity.bars.forEach(bar => {
                    const timelineBar = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    timelineBar.setAttribute('x', bar.x.toString());
                    timelineBar.setAttribute('y', (yPosition + 13).toString());
                    timelineBar.setAttribute('width', bar.width.toString());
                    timelineBar.setAttribute('height', '18');
                    timelineBar.setAttribute('fill', bar.fill);
                    timelineBar.setAttribute('rx', '9');
                    rowGroup.appendChild(timelineBar);
                });
                
                // Row separator
                const separator = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                separator.setAttribute('x1', '0');
                separator.setAttribute('y1', (yPosition + 45).toString());
                separator.setAttribute('x2', '1300');
                separator.setAttribute('y2', (yPosition + 45).toString());
                separator.setAttribute('stroke', '#f1f5f9');
                separator.setAttribute('stroke-width', '1');
                
                rowGroup.appendChild(rowBg);
                rowGroup.appendChild(statusIndicator);
                rowGroup.appendChild(title);
                rowGroup.appendChild(description);
                rowGroup.appendChild(separator);
                
                activityRowsGroup.appendChild(rowGroup);
                
                yPosition += 45;
            });
        }

        // Update all status indicators
        function updateAllStatusIndicators() {
            activities.forEach(activity => {
                const row = document.querySelector(`[data-activity-id="${activity.id}"]`);
                if (row) {
                    const indicator = row.querySelector('.status-indicator');
                    indicator.setAttribute('fill', statusColors[activityStatuses[activity.id]]);
                }
            });
        }

        // Show tooltip
        function showTooltip(event, activity) {
            const rect = event.target.getBoundingClientRect();
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            tooltip.innerHTML = `
                <h3>${activity.title}</h3>
                <div class="tooltip-row">
                    <span class="tooltip-label">Category:</span>
                    <span>${activity.category}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Timeline:</span>
                    <span>${activity.startDate}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Duration:</span>
                    <span>${activity.duration}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Status:</span>
                    <span style="text-transform: capitalize">${activityStatuses[activity.id].replace('-', ' ')}</span>
                </div>
                <div style="margin-top: 8px; font-size: 12px; color: #cbd5e1;">
                    ${activity.description}
                </div>
                <div style="margin-top: 8px; font-size: 11px; color: #94a3b8;">
                    Right-click to change status ‚Ä¢ Changes sync to GitHub
                </div>
            `;
            
            tooltip.style.left = (rect.left + scrollLeft + 20) + 'px';
            tooltip.style.top = (rect.top + scrollTop - 10) + 'px';
            tooltip.classList.add('show');
        }

        // Hide tooltip
        function hideTooltip() {
            tooltip.classList.remove('show');
        }

        // Show status dropdown
        function showStatusDropdown(event, activityId) {
            event.preventDefault();
            currentActivityId = activityId;
            
            const rect = event.target.getBoundingClientRect();
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            statusDropdown.style.left = (rect.left + scrollLeft) + 'px';
            statusDropdown.style.top = (rect.top + scrollTop + 20) + 'px';
            statusDropdown.classList.add('show');
        }

        // Hide status dropdown
        function hideStatusDropdown() {
            statusDropdown.classList.remove('show');
            currentActivityId = null;
        }

        // Update activity status
        async function updateActivityStatus(status) {
            if (currentActivityId) {
                const oldStatus = activityStatuses[currentActivityId];
                
                // Check if user can update (needs token and repo info)
                if (!githubConfig.owner || !githubConfig.repo || !githubConfig.token) {
                    // Show helpful message about configuration needed
                    if (!githubConfig.token) {
                        alert('To update project status, you need to configure GitHub access.\n\n1. Click "Configure GitHub Integration"\n2. Enter repository details\n3. Add your Personal Access Token\n\nCurrent status is read-only.');
                    } else {
                        alert('Repository information missing. Please configure GitHub integration to update status.');
                    }
                    toggleAuthSection();
                    hideStatusDropdown();
                    return;
                }
                
                activityStatuses[currentActivityId] = status;
                
                // Update visual indicator immediately
                const row = document.querySelector(`[data-activity-id="${currentActivityId}"]`);
                const indicator = row.querySelector('.status-indicator');
                indicator.setAttribute('fill', statusColors[status]);
                
                updateProgressSummary();
                hideStatusDropdown();

                // Save to GitHub
                updateSyncStatus('syncing', 'Saving to GitHub...');
                
                try {
                    await saveToGitHub();
                    updateSyncStatus('success', 'Saved to GitHub');
                } catch (error) {
                    console.error('Save error:', error);
                    updateSyncStatus('error', 'Save failed');
                    
                    // Revert the change if save failed
                    activityStatuses[currentActivityId] = oldStatus;
                    indicator.setAttribute('fill', statusColors[oldStatus]);
                    updateProgressSummary();
                    
                    alert('Failed to save to GitHub: ' + error.message);
                }
            }
        }

        // Update progress summary
        function updateProgressSummary() {
            const summary = document.getElementById('progress-summary');
            const statusCounts = {
                'not-started': 0,
                'in-progress': 0,
                'completed': 0,
                'on-hold': 0,
                'blocked': 0
            };
            
            Object.values(activityStatuses).forEach(status => {
                statusCounts[status]++;
            });
            
            const total = activities.length;
            const completedPercentage = Math.round((statusCounts.completed / total) * 100);
            
            summary.innerHTML = `
                <div class="progress-item">
                    <h4 style="color: #10b981">${statusCounts.completed}</h4>
                    <p>Completed</p>
                </div>
                <div class="progress-item">
                    <h4 style="color: #3b82f6">${statusCounts['in-progress']}</h4>
                    <p>In Progress</p>
                </div>
                <div class="progress-item">
                    <h4 style="color: #94a3b8">${statusCounts['not-started']}</h4>
                    <p>Not Started</p>
                </div>
                <div class="progress-item">
                    <h4 style="color: #f59e0b">${statusCounts['on-hold']}</h4>
                    <p>On Hold</p>
                </div>
                <div class="progress-item">
                    <h4 style="color: #ef4444">${statusCounts.blocked}</h4>
                    <p>Blocked</p>
                </div>
                <div class="progress-item">
                    <h4 style="color: #1e3a8a">${completedPercentage}%</h4>
                    <p>Overall Progress</p>
                </div>
            `;
        }

        // Export progress
        function exportProgress() {
            const exportData = {
                timestamp: new Date().toISOString(),
                project: "OFPE Canadian Prairies Project",
                repository: `${githubConfig.owner}/${githubConfig.repo}`,
                activities: activities.map(activity => ({
                    id: activity.id,
                    title: activity.title,
                    category: activity.category,
                    timeline: activity.startDate,
                    duration: activity.duration,
                    status: activityStatuses[activity.id]
                }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ofpe-progress-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadConfiguration();
            createActivityRows();
            updateProgressSummary();
            
            // Add event listeners to activity rows
            document.querySelectorAll('.activity-row').forEach(row => {
                const activityId = parseInt(row.getAttribute('data-activity-id'));
                const activity = activities.find(a => a.id === activityId);
                
                row.addEventListener('mouseenter', (e) => showTooltip(e, activity));
                row.addEventListener('mouseleave', hideTooltip);
                row.addEventListener('contextmenu', (e) => showStatusDropdown(e, activityId));
            });
            
            // Status dropdown options
            document.querySelectorAll('.status-option').forEach(option => {
                option.addEventListener('click', () => {
                    const status = option.getAttribute('data-status');
                    updateActivityStatus(status);
                });
            });
            
            // Click outside to close dropdown
            document.addEventListener('click', (e) => {
                if (!statusDropdown.contains(e.target)) {
                    hideStatusDropdown();
                }
            });

            // Auto-load status on page load (always try to read)
            setTimeout(() => {
                syncWithGitHub();
            }, 1000);
        });
    </script>
</body>
</html>